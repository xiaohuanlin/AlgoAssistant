[tox]
envlist = py311, py312, lint, coverage
isolated_build = True

[testenv]
deps =
    pytest==7.4.3
    pytest-asyncio==0.21.1
    httpx==0.25.2
    pytest-cov==4.1.0
    factory-boy==3.3.0
    -r{toxinidir}/requirements.txt
commands =
    pytest {posargs:tests} --cov=app --cov-report=term-missing --cov-report=html --cov-fail-under=70

[testenv:py311]
basepython = python3.11

[testenv:py312]
basepython = python3.12

[testenv:lint]
deps =
    flake8==6.1.0
    black==23.11.0
    isort==5.12.0
    mypy==1.7.1
commands =
    flake8 app tests
    black --check app tests
    isort --check-only app tests
    mypy app

[testenv:coverage]
deps =
    pytest==7.4.3
    pytest-cov==4.1.0
    coverage==7.3.2
    -r{toxinidir}/requirements.txt
commands =
    pytest tests --cov=app --cov-report=html --cov-report=term-missing --cov-fail-under=70
    coverage report --show-missing

[testenv:fast]
deps =
    pytest==7.4.3
    pytest-asyncio==0.21.1
    httpx==0.25.2
    -r{toxinidir}/requirements.txt
commands =
    pytest tests -x --tb=short

[testenv:security]
deps =
    bandit==1.7.5
    safety==2.3.5
commands =
    bandit -r app -f json -o bandit-report.json
    safety check

[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude = .git,__pycache__,build,dist,*.egg-info

[isort]
profile = black
multi_line_output = 3
line_length = 88

[mypy]
python_version = 3.11
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
disallow_incomplete_defs = True
check_untyped_defs = True
disallow_untyped_decorators = True
no_implicit_optional = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True
strict_equality = True

[coverage:run]
source = app
omit =
    */tests/*
    */test_*
    */__pycache__/*
    */migrations/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod
